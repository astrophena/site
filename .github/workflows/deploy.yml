name: 'Deploy'
on:
  push:
    branches: ['master']
  workflow_dispatch:
jobs:
  site:
    name: 'Site'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Check out'
        uses: 'actions/checkout@v5'
      - name: 'Set up Go'
        uses: 'actions/setup-go@v6'
        with:
          go-version-file: 'go.mod'
      - name: 'Build'
        run: 'go tool build -prod'
      - name: 'Deploy'
        uses: 'easingthemes/ssh-deploy@v5.1.0'
        with:
          SSH_PRIVATE_KEY: '${{ secrets.SSH_KEY }}'
          ARGS: '-rltgoDzv --delete'
          SOURCE: 'build/'
          REMOTE_HOST: '${{ secrets.SSH_HOST }}'
          REMOTE_PORT: '${{ secrets.SSH_PORT }}'
          REMOTE_USER: 'deploy'
          TARGET: '/srv/astrophena.name'
  vanity:
    name: 'Vanity'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Check out'
        uses: 'actions/checkout@v5'
      - name: 'Set up Go'
        uses: 'actions/setup-go@v6'
        with:
          go-version-file: 'go.mod'
      - name: 'Build'
        env:
          GITHUB_TOKEN: '${{ secrets.VANITY_GITHUB_TOKEN }}'
        run: 'go tool build -prod -vanity'
      - name: 'Deploy'
        uses: 'easingthemes/ssh-deploy@v5.1.0'
        with:
          SSH_PRIVATE_KEY: '${{ secrets.SSH_KEY }}'
          ARGS: '-rltgoDzv --delete'
          SOURCE: 'build/'
          REMOTE_HOST: '${{ secrets.SSH_HOST }}'
          REMOTE_PORT: '${{ secrets.SSH_PORT }}'
          REMOTE_USER: 'deploy'
          TARGET: '/srv/go.astrophena.name'
